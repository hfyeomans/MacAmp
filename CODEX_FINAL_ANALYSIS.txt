================================================================================
CODEX URGENT: 4 VIEW INSTANCES CREATED FOR SINGLE DIGIT POSITION
================================================================================

CONFIRMED FACTS FROM LOGS:
✅ 4 SimpleSpriteImage instances created for digit(0)
✅ 4 Image views APPEARED on screen for DIGIT_0_EX
✅ This creates visual double/quadruple rendering
✅ Pattern repeats for ALL 4 digit positions (minute-tens, minute-ones, second-tens, second-ones)

ELIMINATED AS CAUSES:
❌ NOT the MAIN_WINDOW_BACKGROUND (forensically verified clean)
❌ NOT MainWindowView.swift (not in render path)
❌ NOT sprite aliasing (removed from SkinManager)
❌ NOT .onChange(currentTime) (removed)
❌ NOT .id() modifiers (removed)
❌ NOT multiple buildTimeDisplay() calls (only in if-else branches)

CRITICAL CODE:
================================================================================

FILE: MacAmpApp/Views/WinampMainWindow.swift

Line 121: buildTimeDisplay() called in buildFullWindow()
Line 201: buildTimeDisplay() called in buildShadeMode()
Line 257: buildTimeDisplay() function definition

buildTimeDisplay() creates ZStack with:
- Line 278: SimpleSpriteImage(.digit(digits[0])).offset(x: 6, y: 0)
- Line 282: SimpleSpriteImage(.digit(digits[1])).offset(x: 17, y: 0)
- Line 287: SimpleSpriteImage(.character(58)).offset(x: 28, y: 3)
- Line 291: SimpleSpriteImage(.digit(digits[2])).offset(x: 35, y: 0)
- Line 295: SimpleSpriteImage(.digit(digits[3])).offset(x: 46, y: 0)

Then at line 298: .at(Coords.timeDisplay) which is .offset(x: 39, y: 26)

QUESTION FOR CODEX:
================================================================================

Why are 4 SimpleSpriteImage instances being created for EACH digit position?

For example, digit(0) appears in:
- digits[0] (minute tens)
- digits[1] (minute ones)
- digits[2] (second tens)
- digits[3] (second ones)

When time is "00:00", all 4 positions show value 0.

BUT: The logs show 4 CREATED messages for digit(0), which should mean we're calling SimpleSpriteImage(.digit(0)) FOUR TIMES just for the FIRST position.

THEORIES TO INVESTIGATE:
================================================================================

Theory 1: SWIFTUI COPYING VIEWS DURING LAYOUT
----------------------------------------------
When we use .offset(), does SwiftUI create multiple copies for:
- Layout pass
- Rendering pass
- Hit testing pass
- Accessibility pass

Check: Does removing ALL modifiers (.offset, .contentShape, .onTapGesture) fix it?

Theory 2: ZSTACK LAYERING BUG
------------------------------
The buildTimeDisplay() returns a ZStack that gets positioned with .at().

Does ZStack create multiple layers per child view?

Test: Replace ZStack with VStack or HStack and see if duplicates change.

Theory 3: @ENVIRONMENTOBJECT PROPAGATION
----------------------------------------
SimpleSpriteImage uses @EnvironmentObject var skinManager.

When the view is created, does SwiftUI create multiple instances to:
- Test environment availability
- Setup environment injection
- Create view hierarchy
- Render final view

Check: Does making skinManager a direct parameter instead of @EnvironmentObject fix it?

Theory 4: SPRITEIMAGECONTENT DUPLICATION
-----------------------------------------
File: MacAmpApp/Views/Components/SimpleSpriteImage.swift

SimpleSpriteImage.body creates SpriteImageContent.
Does this create 4 instances somehow?

Check the body property at line 48-60.

Theory 5: IMAGE(NSIMAGE:) CACHING
----------------------------------
When Image(nsImage:) is created at line 84:
```swift
Image(nsImage: image)
    .interpolation(.none)
    .antialiased(false)
    .frame(width: width, height: height)
```

Does NSImage caching cause SwiftUI to:
- Create multiple Image views for the same NSImage?
- Layer them due to interpolation settings?
- Duplicate for retina/non-retina displays?

SEARCH COMMANDS:
================================================================================

# Find all buildTimeDisplay calls
grep -rn "buildTimeDisplay()" MacAmpApp --include="*.swift"

# Check if shade mode AND full mode both render
grep -B5 -A15 "if !isShadeMode" MacAmpApp/Views/WinampMainWindow.swift

# Find all .at() usage (might duplicate views)
grep -rn "\.at(" MacAmpApp/Views --include="*.swift" | head -20

# Check extension implementation
grep -A10 "func at(" MacAmpApp/Views/Components/SimpleSpriteImage.swift

# Find all .offset() calls in time display
grep -B2 -A2 "SimpleSpriteImage(.digit" MacAmpApp/Views/WinampMainWindow.swift

SPECIFIC INVESTIGATION:
================================================================================

1. CHECK: Are buildFullWindow() AND buildShadeMode() BOTH being evaluated?

Look at body property lines 64-109:
```swift
ZStack {
    Background
    TitleBar
    if !isShadeMode {
        buildFullWindow()    ← Contains buildTimeDisplay()
    } else {
        buildShadeMode()     ← ALSO contains buildTimeDisplay()
    }
}
```

Even in an if-else, @ViewBuilder might evaluate BOTH branches to determine which to show.

2. CHECK: Extension .at() implementation

Lines 99-106 in SimpleSpriteImage.swift:
```swift
func at(x: CGFloat, y: CGFloat) -> some View {
    self.offset(x: x, y: y)
}
```

Does .offset() create view copies?

3. CHECK: Does .contentShape(Rectangle()) duplicate?

Line 299: .contentShape(Rectangle())

This creates a hit-testing shape. Does it duplicate the view?

4. CHECK: Does .onTapGesture create a copy?

Line 300-302: .onTapGesture { ... }

Tap gestures wrap views - does this create layers?

5. CHECK: Is @ViewBuilder creating copies?

buildTimeDisplay() uses @ViewBuilder.
Does @ViewBuilder evaluate the function body multiple times?

EXPECTED ANSWER:
================================================================================

Find the EXACT line of code or SwiftUI modifier that causes:

SimpleSpriteImage(.digit(digits[0]))  ← This ONE call

To instantiate 4 separate SimpleSpriteImage view objects that all render.

Provide:
1. The specific code causing duplication
2. Why it creates 4 instances
3. The fix to make it create only 1 instance
4. Explanation of the SwiftUI behavior involved

PRIORITY CHECKLIST:
================================================================================

[HIGH] Check if both buildFullWindow AND buildShadeMode evaluate simultaneously
[HIGH] Test if .offset() creates ghost views
[HIGH] Check if @ViewBuilder evaluates body multiple times
[MED] Investigate .contentShape() behavior
[MED] Check .onTapGesture wrapper behavior
[LOW] NSImage caching issues
[LOW] @EnvironmentObject injection

================================================================================
CURRENT STATE:
- ALL .id() modifiers removed
- .onChange(currentTime) removed
- Sprite aliasing removed
- Clean semantic architecture
- Still seeing 4 instances per digit position

Please find the root cause in the SwiftUI view construction!
================================================================================
